<div class="mb-3">
  <a href="/dashboard" class="btn btn-secondary btn-sm">← Back to Dashboard</a>
</div>

<h2>Policy <%= policy.policy_id %> – <%= policy.type_name %></h2>

<div class="row">
  <div class="col-md-6">
    <div class="card mb-3">
      <div class="card-header">Policy Info</div>
      <div class="card-body">
        <p><strong>Status:</strong> <span class="badge <%= policy.status_name === 'Active' ? 'bg-success' : 'bg-secondary' %>"><%= policy.status_name %></span></p>
        <p><strong>Start Date:</strong> <%= policy.start_date %></p>
        <p><strong>End Date:</strong> <%= policy.end_date %></p>
        <p><strong>Base Premium:</strong> <span class="text-success">${<%= Number(policy.base_premium).toFixed(2) %></span></p>
        <p class="text-muted small">Created: <%= new Date(policy.created_at).toLocaleDateString() %></p>
      </div>
    </div>

    <% if (policy.details) { %>
      <% if (policy.type_name === 'Auto') { %>
        <%- include('partials/_autoPolicyDetail', { details: policy.details }) %>
      <% } else if (policy.type_name === 'Home') { %>
        <%- include('partials/_homePolicyDetail', { details: policy.details }) %>
      <% } else if (policy.type_name === 'Pet') { %>
        <%- include('partials/_petPolicyDetail', { details: policy.details }) %>
      <% } else if (policy.type_name === 'Renters') { %>
        <%- include('partials/_rentersPolicyDetail', { details: policy.details }) %>
      <% } else if (policy.type_name === 'Business') { %>
        <%- include('partials/_businessPolicyDetail', { details: policy.details }) %>
      <% } else if (policy.type_name === 'Health') { %>
        <%- include('partials/_healthPolicyDetail', { details: policy.details }) %>
      <% } else if (policy.type_name === 'Life') { %>
        <%- include('partials/_lifePolicyDetail', { details: policy.details }) %>
      <% } %>
    <% } %>
  </div>
  <div class="col-md-6">
    <div class="card mb-3">
      <div class="card-header d-flex justify-content-between align-items-center">
        <span>Claims</span>
        <a href="/claims/new/<%= policy.policy_id %>" class="btn btn-sm btn-outline-primary">File Claim</a>
      </div>
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-sm">
            <thead><tr><th>Date</th><th>Amount</th><th>Status</th></tr></thead>
            <tbody>
            <% if (claims && claims.length) { %>
              <% claims.forEach(c => { %>
                <tr>
                  <td><%= c.claim_date %></td>
                  <td>$<%= Number(c.claim_amount).toFixed(2) %></td>
                  <td><%= c.claim_status %></td>
                </tr>
              <% }) %>
            <% } else { %>
              <tr><td colspan="3" class="text-muted">No claims.</td></tr>
            <% } %>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <div class="card mb-3">
      <div class="card-header d-flex justify-content-between align-items-center">
        <span>Payments</span>
        <a href="/payments/<%= policy.policy_id %>" class="btn btn-sm btn-outline-secondary">View Payments</a>
      </div>
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-sm">
            <thead><tr><th>Date</th><th>Amount</th><th>Status</th></tr></thead>
            <tbody>
            <% if (payments && payments.length) { %>
              <% payments.forEach(p => { %>
                <tr>
                  <td><%= p.payment_date %></td>
                  <td>$<%= Number(p.amount).toFixed(2) %></td>
                  <td><%= p.status %></td>
                </tr>
              <% }) %>
            <% } else { %>
              <tr><td colspan="3" class="text-muted">No payments.</td></tr>
            <% } %>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
