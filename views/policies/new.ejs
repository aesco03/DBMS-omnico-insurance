<h2>Get a Quote</h2>
<p class="text-muted">Enter basic policy details to generate a quote for your coverage.</p>

<form action="/policies/new" method="post" class="mt-3">
  <div class="mb-3">
    <label class="form-label">Policy Type</label>
    <select id="policyType" name="type_id" class="form-select">
      <option value="1">Auto</option>
      <option value="2">Home</option>
    </select>
  </div>
  <div class="row">
    <div class="col-md-4 mb-3">
      <label class="form-label">Start Date</label>
      <input type="date" name="start_date" class="form-control" value="<%= old.start_date || '' %>">
    </div>
    <div class="col-md-4 mb-3">
      <label class="form-label">End Date</label>
      <input type="date" name="end_date" class="form-control" value="<%= old.end_date || '' %>">
    </div>
    <div class="col-md-4 mb-3">
      <label class="form-label">Base Premium</label>
      <input type="number" name="base_premium" step="0.01" class="form-control" value="<%= old.base_premium || '' %>">
    </div>
  </div>
  <% if (errors && errors.length) { %>
    <div class="alert alert-danger">
      <ul class="mb-0">
        <% errors.forEach(e => { %>
          <li><%= e.msg %></li>
        <% }) %>
      </ul>
    </div>
  <% } %>

  <!-- Auto-specific fields -->
  <div id="autoFields" style="display: none;">
    <h5>Auto Details</h5>
    <div class="row">
      <div class="col-md-4 mb-3">
        <label class="form-label">Vehicle Make</label>
        <input type="text" name="vehicle_make" class="form-control" value="<%= old.vehicle_make || '' %>">
      </div>
      <div class="col-md-4 mb-3">
        <label class="form-label">Model</label>
        <input type="text" name="vehicle_model" class="form-control" value="<%= old.vehicle_model || '' %>">
      </div>
      <div class="col-md-2 mb-3">
        <label class="form-label">Year</label>
        <input type="number" name="vehicle_year" class="form-control" value="<%= old.vehicle_year || '' %>">
      </div>
      <div class="col-md-2 mb-3">
        <label class="form-label">VIN</label>
        <input type="text" name="vehicle_vin" class="form-control" value="<%= old.vehicle_vin || '' %>">
      </div>
    </div>
    <div class="row">
      <div class="col-md-4 mb-3">
        <label class="form-label">Coverage Type</label>
        <input type="text" name="coverage_type" class="form-control" value="<%= old.coverage_type || '' %>">
      </div>
      <div class="col-md-4 mb-3">
        <label class="form-label">Estimated Premium</label>
        <input type="number" name="auto_premium" step="0.01" class="form-control" value="<%= old.auto_premium || '' %>">
      </div>
    </div>
  </div>

  <!-- Home-specific fields -->
  <div id="homeFields" style="display: none;">
    <h5>Home Details</h5>
    <div class="mb-3">
      <label class="form-label">Property Address</label>
      <input type="text" name="property_address" class="form-control" value="<%= old.property_address || '' %>">
    </div>
    <div class="row">
      <div class="col-md-4 mb-3">
        <label class="form-label">Property Value</label>
        <input type="number" name="property_value" step="0.01" class="form-control" value="<%= old.property_value || '' %>">
      </div>
      <div class="col-md-4 mb-3">
        <label class="form-label">Coverage Limit</label>
        <input type="number" name="coverage_limit" step="0.01" class="form-control" value="<%= old.coverage_limit || '' %>">
      </div>
      <div class="col-md-4 mb-3">
        <label class="form-label">Deductible</label>
        <input type="number" name="deductible" step="0.01" class="form-control" value="<%= old.deductible || '' %>">
      </div>
    </div>
  </div>
  <button class="btn btn-primary" type="submit">Create Quote</button>
</form>

<script>
  (function(){
    const typeSelect = document.getElementById('policyType');
    const autoFields = document.getElementById('autoFields');
    const homeFields = document.getElementById('homeFields');

    function updateFields() {
      const val = typeSelect.value;
      if (val === '1') { // Auto
        autoFields.style.display = '';
        homeFields.style.display = 'none';
      } else if (val === '2') { // Home
        autoFields.style.display = 'none';
        homeFields.style.display = '';
      } else {
        autoFields.style.display = 'none';
        homeFields.style.display = 'none';
      }
    }

    typeSelect.addEventListener('change', updateFields);
    // initial
    updateFields();
  })();
</script>

